<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Panel - Logbook System</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    /* Responsive grid for dashboard cards */
    @media (max-width: 768px) {
      .dashboard-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
        margin-bottom: 1.2rem;
      }
      .dashboard-card {
        padding: 0.7rem !important;
        font-size: 0.98rem;
        min-width: 0;
        margin-bottom: 0.5rem;
        box-shadow: 0 2px 8px rgba(16,185,129,0.10);
      }
      .dashboard-card span {
        font-size: 1.05rem !important;
      }
      .dashboard-card .text-xs {
        font-size: 0.85rem !important;
      }
      .dashboard-card .text-2xl {
        font-size: 1.3rem !important;
      }
      .admin-table th, .admin-table td {
        padding: 0.32rem !important;
        font-size: 0.92rem !important;
      }
      .admin-table th {
        white-space: nowrap;
        font-size: 0.95rem !important;
      }
      .admin-table td {
        min-width: 90px;
        white-space: nowrap;
        font-size: 0.92rem !important;
      }
      .overflow-x-auto {
        overflow-x: auto !important;
        -webkit-overflow-scrolling: touch;
        position: relative;
      }
      .table-scroll-hint {
        display: block;
        position: absolute;
        right: 10px;
        top: 8px;
        font-size: 0.8rem;
        color: #059669;
        background: #e0f2fe;
        padding: 2px 8px;
        border-radius: 999px;
        z-index: 2;
      }
    }
    @media (max-width: 480px) {
      .dashboard-card {
        padding: 0.5rem !important;
        font-size: 0.92rem !important;
      }
      .dashboard-card .text-2xl {
        font-size: 1.1rem !important;
      }
      .admin-table th, .admin-table td {
        padding: 0.18rem !important;
        font-size: 0.82rem !important;
      }
      .admin-table td {
        min-width: 80px;
      }
      .table-scroll-hint {
        font-size: 0.7rem;
        right: 4px;
        top: 4px;
      }
    }
  body { font-family: 'Poppins', 'Inter', sans-serif; }
  .sidebar { min-width: 180px; max-width: 200px; width: 16vw; position: sticky; top: 0; height: 100vh; box-shadow: 0 8px 32px rgba(16,185,129,0.12); z-index: 50; }
    .active, .sidebar button:focus { background: linear-gradient(90deg, #059669 60%, #10b981 100%); color: #fff; }
    .card { box-shadow: 0 8px 32px rgba(16,185,129,0.10); transition: box-shadow 0.2s; }
    .card:hover { box-shadow: 0 16px 48px rgba(16,185,129,0.18); }
    .sidebar button { transition: background 0.2s, color 0.2s; }
    .sidebar button:hover { background: #047857; color: #fff; }
    .sidebar .font-bold { letter-spacing: 1px; }
    .section-header { font-size: 2.25rem; font-weight: 700; color: #059669; margin-bottom: 0.5rem; letter-spacing: 0.5px; }
    .section-sub { color: #6ee7b7; font-size: 1rem; margin-bottom: 2rem; }
    .admin-table th, .admin-table td { padding: 1rem; }
    .admin-table th { background: linear-gradient(90deg, #059669 60%, #10b981 100%); color: #fff; }
    .admin-table tr { transition: background 0.2s; }
    .admin-table tr:hover { background: #f0fdf4; }
    .btn-primary, .bg-green-600 { box-shadow: 0 2px 8px rgba(16,185,129,0.10); transition: box-shadow 0.2s, transform 0.2s; }
    .btn-primary:hover, .bg-green-600:hover { box-shadow: 0 8px 24px rgba(16,185,129,0.18); transform: translateY(-2px); }
    .rounded-2xl { border-radius: 1rem; }
    .rounded-3xl { border-radius: 1.5rem; }
    .shadow-2xl { box-shadow: 0 16px 48px rgba(16,185,129,0.12); }
    .search-input:focus { box-shadow: 0 4px 16px rgba(16,185,129,0.10); }
    .bg-white { background: linear-gradient(135deg, #fff 80%, #e0f2fe 100%); }
    .sidebar { background: linear-gradient(180deg, #059669 80%, #047857 100%); }
    .sidebar .w-12 { box-shadow: 0 2px 8px rgba(220,38,38,0.10); }
    .sidebar .w-12:hover { box-shadow: 0 8px 24px rgba(220,38,38,0.18); }
    .sidebar .font-bold { font-family: 'Poppins', sans-serif; }
    .sidebar nav button { font-family: 'Inter', sans-serif; font-size: 1rem; }
    .sidebar nav button.active { font-weight: 600; }
    .sidebar nav button:focus { outline: none; }
    .sidebar nav button:active { background: #065f46; }
    .sidebar nav { margin-bottom: 2rem; }
    .sidebar .bg-red-600 { margin-top: 2rem; }
    @media (max-width: 1024px) {
      .sidebar { min-width: 120px; max-width: 160px; width: 28vw; padding: 0.5rem; }
      .section-header { font-size: 1.5rem; }
      .admin-table th, .admin-table td { padding: 0.5rem; }
    }
    @media (max-width: 768px) {
      .sidebar {
        position: fixed;
        left: 0;
        top: 0;
        height: 100vh;
        min-width: 220px;
        max-width: 80vw;
        width: 70vw;
        z-index: 100;
        padding: 1rem 0.5rem;
        display: flex;
        flex-direction: column;
        transform: translateX(-100%);
        transition: transform 0.3s cubic-bezier(.4,0,.2,1);
        box-shadow: 0 8px 32px rgba(16,185,129,0.18);
      }
      .sidebar.open {
        transform: translateX(0);
      }
      .sidebar nav { flex-direction: column; display: flex; gap: 0.5rem; margin-bottom: 0; }
      .sidebar nav button { font-size: 0.95rem; padding: 0.7rem 1rem; }
      .sidebar .font-bold, .sidebar .text-xl { font-size: 1.1rem; }
      .sidebar .w-12, .sidebar .h-12 { width: 2.5rem; height: 2.5rem; }
      .sidebar .bg-red-600 { margin-top: 0; }
      main { margin-left: 0 !important; padding: 1rem !important; }
      .section-header { font-size: 1.1rem; }
      .admin-table th, .admin-table td { padding: 0.4rem; font-size: 0.9rem; }
      .rounded-3xl, .rounded-2xl { border-radius: 0.7rem; }
      .card { padding: 1rem !important; }
      .overflow-x-auto { overflow-x: scroll !important; }
      .search-input, input, select, button { font-size: 0.95rem !important; padding: 0.7rem 0.8rem !important; }
      .flex { flex-direction: column !important; }
      .min-h-screen { min-height: 100vh !important; }
      .mobile-nav {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0.7rem 1rem;
        background: linear-gradient(90deg, #059669 80%, #047857 100%);
        color: #fff;
        position: sticky;
        top: 0;
        z-index: 101;
      }
      .mobile-nav .hamburger {
        background: none;
        border: none;
        padding: 0.3rem;
        cursor: pointer;
        outline: none;
      }
      .sidebar-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0,0,0,0.25);
        z-index: 99;
        display: none;
      }
      .sidebar-overlay.open {
        display: block;
      }
    }
    @media (max-width: 480px) {
      .sidebar { min-width: 70vw; max-width: 90vw; width: 90vw; padding: 0.3rem; }
      .sidebar nav button { font-size: 0.85rem; padding: 0.5rem 0.7rem; }
      .section-header { font-size: 1rem; }
      .admin-table th, .admin-table td { padding: 0.2rem; font-size: 0.8rem; }
      .rounded-3xl, .rounded-2xl { border-radius: 0.4rem; }
      .card { padding: 0.5rem !important; }
      .search-input, input, select, button { font-size: 0.85rem !important; padding: 0.5rem 0.6rem !important; }
    }
  </style>
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-firestore-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-50">
  <div id="adminEmailDebug" class="w-full text-center py-2 text-sm text-gray-600 bg-yellow-100"></div>
  <div class="mobile-nav md:hidden">
    <span class="font-bold text-lg" style="font-family:'Poppins',sans-serif;">Admin Panel</span>
    <button class="hamburger" id="sidebarToggle" aria-label="Open menu">
      <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="4" y1="7" x2="20" y2="7"/><line x1="4" y1="12" x2="20" y2="12"/><line x1="4" y1="17" x2="20" y2="17"/></svg>
    </button>
  </div>
  <div class="sidebar-overlay" id="sidebarOverlay"></div>
  <div class="flex min-h-screen flex-col md:flex-row">
    <!-- Sidebar -->
    <aside class="sidebar bg-gradient-to-b from-green-700 to-emerald-700 text-white flex flex-col py-8 px-4 shadow-2xl">
  <div class="flex items-center mb-8 space-x-3">
        <div class="w-12 h-12 bg-gradient-to-r from-red-600 to-red-700 rounded-xl flex items-center justify-center">
          <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5-6a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
        </div>
        <span class="font-bold text-xl" style="font-family:'Poppins',sans-serif;">Admin Panel</span>
      </div>
  <nav class="flex-1 space-y-2 md:space-y-2 flex flex-col md:flex-col">
        <button class="w-full text-left py-2 px-4 rounded-lg hover:bg-green-800 transition font-medium flex items-center gap-2" onclick="showSection('dashboard')">
          <span><svg class="inline w-5 h-5 mr-1" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M3 3h18v18H3V3z"/><path stroke-linecap="round" stroke-linejoin="round" d="M8 17l4-4 4 4"/></svg></span> Dashboard Overview
        </button>
        <button class="w-full text-left py-2 px-4 rounded-lg hover:bg-green-800 transition font-medium flex items-center gap-2" onclick="showSection('users')">
          <span><svg class="inline w-5 h-5 mr-1" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="8" r="4"/><path stroke-linecap="round" stroke-linejoin="round" d="M6 20v-2a6 6 0 0112 0v2"/></svg></span> User Management
        </button>
        <button class="w-full text-left py-2 px-4 rounded-lg hover:bg-green-800 transition font-medium flex items-center gap-2" onclick="showSection('logs')">
          <span><svg class="inline w-5 h-5 mr-1" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><rect x="3" y="7" width="18" height="13" rx="2"/><path stroke-linecap="round" stroke-linejoin="round" d="M8 7V5a4 4 0 018 0v2"/></svg></span> Logbook Entries
        </button>
        <button class="w-full text-left py-2 px-4 rounded-lg hover:bg-green-800 transition font-medium flex items-center gap-2" onclick="showSection('departments')">
          <span><svg class="inline w-5 h-5 mr-1" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="7" rx="1.5"/><rect x="14" y="3" width="7" height="7" rx="1.5"/><rect x="14" y="14" width="7" height="7" rx="1.5"/><rect x="3" y="14" width="7" height="7" rx="1.5"/></svg></span> Department Management
        </button>
        <button class="w-full text-left py-2 px-4 rounded-lg hover:bg-green-800 transition font-medium flex items-center gap-2" onclick="showSection('reports')">
          <span><svg class="inline w-5 h-5 mr-1" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9 17v-6a2 2 0 012-2h2a2 2 0 012 2v6m-6 0h6"/><rect x="3" y="3" width="18" height="18" rx="2"/></svg></span> Reports & Analytics
        </button>
        <button class="w-full text-left py-2 px-4 rounded-lg hover:bg-green-800 transition font-medium flex items-center gap-2" onclick="showSection('settings')">
          <span><svg class="inline w-5 h-5 mr-1" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"/><path stroke-linecap="round" stroke-linejoin="round" d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 01-2.83 2.83l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09a1.65 1.65 0 00-1-1.51 1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09a1.65 1.65 0 001.51-1 1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06a1.65 1.65 0 001.82.33h.09a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51h.09a1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06a1.65 1.65 0 00-.33 1.82v.09a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/></svg></span> System Settings
        </button>
        <button class="w-full text-left py-2 px-4 rounded-lg hover:bg-green-800 transition font-medium flex items-center gap-2" onclick="showSection('notifications')">
          <span><svg class="inline w-5 h-5 mr-1" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/></svg></span> Notifications & Logs
        </button>
        <button class="w-full text-left py-2 px-4 rounded-lg hover:bg-green-800 transition font-medium flex items-center gap-2" onclick="showSection('profile')">
          <span><svg class="inline w-5 h-5 mr-1" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="8" r="4"/><path stroke-linecap="round" stroke-linejoin="round" d="M6 20v-2a6 6 0 0112 0v2"/></svg></span> Admin Profile
        </button>
      </nav>
      <button id="logoutBtn" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-semibold mt-8 flex items-center gap-2"><svg class="inline w-5 h-5 mr-1" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M17 16l4-4m0 0l-4-4m4 4H7"/></svg>Sign Out</button>
    </aside>
    <!-- Main Content -->
    <main class="flex-1 p-6 md:p-10">
      <!-- Dashboard Overview -->
  <section id="section-dashboard" class="block">
        <h1 class="text-3xl font-bold text-green-700 mb-2">Dashboard Overview</h1>
        <div class="dashboard-grid grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
          <div class="dashboard-card bg-white rounded-2xl card p-6 flex flex-col items-start">
            <span class="text-gray-500 text-xs mb-1">Total Entries</span>
            <span id="statTotalEntries" class="text-2xl font-bold text-green-700">0</span>
          </div>
          <div class="dashboard-card bg-white rounded-2xl card p-6 flex flex-col items-start">
            <span class="text-gray-500 text-xs mb-1">Total Users</span>
            <span id="statTotalUsers" class="text-2xl font-bold text-green-700">0</span>
          </div>
          <div class="dashboard-card bg-white rounded-2xl card p-6 flex flex-col items-start">
            <span class="text-gray-500 text-xs mb-1">Entries This Week</span>
            <span id="statEntriesWeek" class="text-2xl font-bold text-green-700">0</span>
          </div>
          <div class="dashboard-card bg-white rounded-2xl card p-6 flex flex-col items-start">
            <span class="text-gray-500 text-xs mb-1">Pending/Flagged</span>
            <span id="statPendingFlagged" class="text-2xl font-bold text-green-700">0</span>
          </div>
        </div>
        <div class="bg-white rounded-2xl card p-6 mb-8 overflow-x-auto" style="min-width:320px; position:relative;">
          <span class="table-scroll-hint">Scroll &rarr;</span>
          <canvas id="overviewChart" height="80" style="min-width:320px;"></canvas>
        </div>
      </section>
      <!-- User Management -->
      <section id="section-users" class="hidden">
        <h1 class="text-2xl font-bold text-green-700 mb-2">User Management</h1>
  <div class="mb-6 flex flex-col sm:flex-row sm:items-center gap-4 w-full">
          <div class="relative w-full sm:w-1/3">
            <span class="absolute left-3 top-1/2 -translate-y-1/2 text-green-400">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-4.35-4.35"/></svg>
            </span>
            <input type="text" id="userSearchInput" placeholder="Search users..." class="pl-10 pr-4 py-3 border-2 border-green-100 bg-green-50 rounded-xl focus:outline-none focus:border-green-500 shadow-sm w-full" />
          </div>
          <select id="departmentFilter" class="w-full sm:w-1/4 px-4 py-3 border-2 border-green-100 bg-green-50 rounded-xl focus:outline-none focus:border-green-500 shadow-sm">
            <option value="">All Departments</option>
          </select>
          <button class="bg-green-600 text-white px-5 py-2 rounded-xl font-semibold shadow hover:bg-green-700 transition w-full sm:w-auto" onclick="showAddUserModal()">+ Add User</button>
        </div>
  <div class="overflow-x-auto bg-white rounded-3xl card shadow-2xl w-full" style="min-width:320px; position:relative;">
    <span class="table-scroll-hint">Scroll &rarr;</span>
          <table class="w-full text-left border-separate" style="border-spacing:0">
            <thead class="bg-gradient-to-r from-green-700 to-green-600 text-white sticky top-0 z-10 shadow">
              <tr>
                <th class="p-4 font-semibold rounded-tl-3xl">User</th>
                <th class="p-4 font-semibold">Email</th>
                <th class="p-4 font-semibold">Status</th>
                <th class="p-4 font-semibold">Role</th>
                <th class="p-4 font-semibold rounded-tr-3xl">Actions</th>
              </tr>
            </thead>
            <tbody id="usersTable" class="text-gray-700">
              <!-- Users will load here -->
            </tbody>
          </table>
        </div>
      </section>
      <!-- Logbook Entries Management -->
      <section id="section-logs" class="hidden">
        <h1 class="text-2xl font-bold text-green-700 mb-2">Logbook Entries Management</h1>
  <div class="mb-6 flex flex-col sm:flex-row sm:items-center gap-4 w-full">
          <input type="text" id="logSearchInput" placeholder="Search by user, date, department..." class="w-full sm:w-1/3 px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-green-500" />
          <select id="logDeptFilter" class="w-full sm:w-1/4 px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-green-500">
            <option value="">All Departments</option>
          </select>
          <select id="logStatusFilter" class="w-full sm:w-1/4 px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-green-500">
            <option value="">All Statuses</option>
            <option value="pending">Pending</option>
            <option value="approved">Approved</option>
            <option value="rejected">Rejected</option>
            <option value="flagged">Flagged</option>
          </select>
        </div>
  <div class="overflow-x-auto bg-white rounded-3xl card w-full">
          <table class="w-full text-left border-collapse">
            <thead class="bg-gradient-to-r from-green-700 to-green-600 text-white">
              <tr>
                <th class="p-4 font-semibold rounded-tl-3xl">User</th>
                <th class="p-4 font-semibold">Date</th>
                <th class="p-4 font-semibold">Department</th>
                <th class="p-4 font-semibold">Status</th>
                <th class="p-4 font-semibold">Actions</th>
                <th class="p-4 font-semibold rounded-tr-3xl">Photo</th>
              </tr>
            </thead>
            <tbody id="logEntriesTable" class="text-gray-700">
              <!-- Entries will load here -->
            </tbody>
          </table>
        </div>
      </section>
      <!-- Department Management -->
      <section id="section-departments" class="hidden">
        <h1 class="text-2xl font-bold text-green-700 mb-2">Department / Project Management</h1>
  <div class="mb-6 flex flex-col sm:flex-row sm:items-center gap-4 w-full">
          <input type="text" id="deptNameInput" placeholder="Add new department..." class="w-full sm:w-1/3 px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-green-500" />
          <button class="bg-green-600 text-white px-4 py-2 rounded-lg font-semibold w-full sm:w-auto" onclick="addDepartment()">+ Add Department</button>
        </div>
  <div class="overflow-x-auto bg-white rounded-3xl card w-full">
          <table class="w-full text-left border-collapse">
            <thead class="bg-gradient-to-r from-green-700 to-green-600 text-white">
              <tr>
                <th class="p-4 font-semibold rounded-tl-3xl">Department</th>
                <th class="p-4 font-semibold">Users</th>
                <th class="p-4 font-semibold">Actions</th>
              </tr>
            </thead>
            <tbody id="departmentsTable" class="text-gray-700">
              <!-- Departments will load here -->
            </tbody>
          </table>
        </div>
      </section>
      <!-- Reports & Analytics -->
      <section id="section-reports" class="hidden">
        <h1 class="text-2xl font-bold text-green-700 mb-2">Reports & Analytics</h1>
        <div class="bg-white rounded-2xl card p-6 text-gray-400 text-center">[Reports & analytics UI coming soon]</div>
      </section>
      <!-- System Settings -->
      <section id="section-settings" class="hidden">
        <h1 class="text-2xl font-bold text-green-700 mb-2">System Settings</h1>
        <div class="bg-white rounded-2xl card p-6 text-gray-400 text-center">[Settings UI coming soon]</div>
      </section>
      <!-- Notifications & Logs -->
      <section id="section-notifications" class="hidden">
        <h1 class="text-2xl font-bold text-green-700 mb-2">Notifications & Logs</h1>
        <div class="bg-white rounded-2xl card p-6 text-gray-400 text-center">[Notifications & logs UI coming soon]</div>
      </section>
      <!-- Admin Profile -->
      <section id="section-profile" class="hidden">
        <h1 class="text-2xl font-bold text-green-700 mb-2">Admin Profile</h1>
        <div class="bg-white rounded-2xl card p-6 text-gray-400 text-center">[Profile settings coming soon]</div>
      </section>
    </main>
  </div>
  <script>
    // Sidebar mobile toggle
    const sidebar = document.querySelector('.sidebar');
    const sidebarToggle = document.getElementById('sidebarToggle');
    const sidebarOverlay = document.getElementById('sidebarOverlay');
    function openSidebar() {
      sidebar.classList.add('open');
      sidebarOverlay.classList.add('open');
      document.body.style.overflow = 'hidden';
    }
    function closeSidebar() {
      sidebar.classList.remove('open');
      sidebarOverlay.classList.remove('open');
      document.body.style.overflow = '';
    }
    sidebarToggle && sidebarToggle.addEventListener('click', openSidebar);
    sidebarOverlay && sidebarOverlay.addEventListener('click', closeSidebar);
    // Close sidebar on nav click (mobile)
    sidebar && sidebar.querySelectorAll('nav button').forEach(btn => {
      btn.addEventListener('click', () => {
        if (window.innerWidth <= 768) closeSidebar();
      });
    });
    // Only allow access for specific admin (replace with your email)
    const allowedAdminEmail = "bamisetoyin9@gmail.com";
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyDbNz-RNef9HTz1QxqTF4SGdSlOd7zRCNE",
      authDomain: "iitapro.firebaseapp.com",
      projectId: "iitapro",
      storageBucket: "iitapro.appspot.com",
      messagingSenderId: "390594034949",
      appId: "1:390594034949:web:a9560d8ab874addb654b6c"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // Section navigation
    function showSection(section) {
      const sections = ['dashboard','users','logs','departments','reports','settings','notifications','profile'];
      sections.forEach(s => {
        document.getElementById('section-' + s).classList.toggle('hidden', s !== section);
        document.getElementById('section-' + s).classList.toggle('block', s === section);
      });
    }
    showSection('dashboard');

    // Auth check
    auth.onAuthStateChanged(user => {
      const debugDiv = document.getElementById('adminEmailDebug');
      if (user && user.email) {
        debugDiv.textContent = `Signed in as: ${user.email}`;
      } else {
        debugDiv.textContent = 'Not signed in.';
      }
      if (!user || user.email !== allowedAdminEmail) {
        alert('Access denied. Only the admin can view this page.');
        window.location.href = "login.html";
      }
    });
    document.getElementById("logoutBtn").onclick = function () {
      auth.signOut().then(() => {
        window.location.href = "login.html";
      });
    };

    // --- Real-time Dashboard Stats & Chart ---
    let overviewChart;
    function updateDashboardStats(entries, users) {
      // Total Entries
      document.getElementById('statTotalEntries').textContent = entries.length;
      // Total Users
      document.getElementById('statTotalUsers').textContent = users.length;
      // Entries This Week
      const now = new Date();
      const weekAgo = new Date(now.getFullYear(), now.getMonth(), now.getDate() - 7);
      const entriesWeek = entries.filter(e => {
        const d = e.date ? new Date(e.date) : null;
        return d && d >= weekAgo;
      });
      document.getElementById('statEntriesWeek').textContent = entriesWeek.length;
      // Pending/Flagged
      const pendingFlagged = entries.filter(e => e.status === 'pending' || e.status === 'flagged');
      document.getElementById('statPendingFlagged').textContent = pendingFlagged.length;
      // Chart
      const days = [...Array(7).keys()].map(i => {
        const d = new Date(now.getFullYear(), now.getMonth(), now.getDate() - i);
        return d.toISOString().slice(0,10);
      }).reverse();
      const dayCounts = days.map(day => entries.filter(e => (e.date||'').slice(0,10) === day).length);
      if (!overviewChart) {
        overviewChart = new Chart(document.getElementById('overviewChart').getContext('2d'), {
          type: 'line',
          data: {
            labels: days,
            datasets: [{
              label: 'Entries per Day',
              data: dayCounts,
              backgroundColor: '#10b98133',
              borderColor: '#059669',
              fill: true,
              tension: 0.3
            }]
          },
          options: {
            responsive: true,
            plugins: { legend: { display: false } }
          }
        });
      } else {
        overviewChart.data.labels = days;
        overviewChart.data.datasets[0].data = dayCounts;
        overviewChart.update();
      }
    }

    // Listen for real-time updates
    let entries = [], users = [];
    db.collection('entries').onSnapshot(snap => {
      entries = snap.docs.map(doc => ({id: doc.id, ...doc.data()}));
      updateDashboardStats(entries, users);
    });
    db.collection('users').onSnapshot(snap => {
      users = snap.docs.map(doc => ({id: doc.id, ...doc.data()}));
      updateDashboardStats(entries, users);
    });
    // ...listeners for other tabs will be added next...
    // --- Real-time User Management ---
    function renderUserTable(users) {
      const tbody = document.getElementById('usersTable');
      tbody.innerHTML = '';
      users.forEach(user => {
        const tr = document.createElement('tr');
        // Avatar or initials
        let avatarHtml = '';
        if (user.photoUrl) {
          avatarHtml = `<img src='${user.photoUrl}' class='w-10 h-10 rounded-full object-cover border-2 border-green-200 shadow mr-2' alt='avatar'/>`;
        } else {
          const initials = (user.name||'').split(' ').map(n=>n[0]).join('').slice(0,2).toUpperCase();
          avatarHtml = `<div class='w-10 h-10 rounded-full bg-green-100 text-green-700 flex items-center justify-center font-bold mr-2 border-2 border-green-200 shadow'>${initials||'U'}</div>`;
        }
        tr.className = 'hover:bg-green-50 transition';
        tr.innerHTML = `
          <td class='flex items-center py-3'>${avatarHtml}<span class='font-semibold'>${user.name || ''}</span></td>
          <td class='py-3'>${user.email ? user.email : user.id}</td>
          <td class='py-3'>Active</td>
          <td class='py-3'>Student</td>
          <td class='py-3'>
            <button class='bg-green-600 text-white px-3 py-1 rounded hover:bg-green-700 focus:outline-none transition' title='Edit'>Edit</button>
            <button class='bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600 focus:outline-none transition ml-2' title='Delete'>Delete</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    function updateDepartmentFilter(users) {
      const deptSet = new Set(users.map(u => u.department).filter(Boolean));
      const select = document.getElementById('departmentFilter');
      select.innerHTML = `<option value="">All Departments</option>`;
      deptSet.forEach(dept => {
        select.innerHTML += `<option value="${dept}">${dept}</option>`;
      });
    }

    // User search/filter logic
    document.getElementById('userSearchInput').addEventListener('input', function() {
      filterAndRenderUsers();
    });
    document.getElementById('departmentFilter').addEventListener('change', function() {
      filterAndRenderUsers();
    });

    function filterAndRenderUsers() {
      const search = document.getElementById('userSearchInput').value.toLowerCase();
      const dept = document.getElementById('departmentFilter').value;
      let filtered = users;
      if (dept) filtered = filtered.filter(u => u.department === dept);
      if (search) filtered = filtered.filter(u =>
        (u.name||'').toLowerCase().includes(search) ||
        (u.email||'').toLowerCase().includes(search) ||
        (u.department||'').toLowerCase().includes(search)
      );
      renderUserTable(filtered);
    }

    // Update user table and department filter in real time
    db.collection('users').onSnapshot(snap => {
      users = snap.docs.map(doc => ({id: doc.id, ...doc.data()}));
      updateDepartmentFilter(users);
      filterAndRenderUsers();
    });
    // --- Real-time Logbook Entries Management ---
    function renderLogEntriesTable(entries) {
      const tbody = document.getElementById('logEntriesTable');
      tbody.innerHTML = '';
      entries.forEach(entry => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${entry.userName || ''}</td>
          <td>${entry.date ? new Date(entry.date).toLocaleDateString() : ''}</td>
          <td>${entry.department || ''}</td>
          <td>${entry.status || ''}</td>
          <td>
            <button class='bg-green-600 text-white px-2 py-1 rounded' title='Approve'>Approve</button>
            <button class='bg-red-600 text-white px-2 py-1 rounded ml-2' title='Reject'>Reject</button>
          </td>
          <td>${entry.photoUrl ? `<img src='${entry.photoUrl}' class='w-12 h-12 rounded-xl object-cover'/>` : ''}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    function updateLogDeptFilter(entries) {
      const deptSet = new Set(entries.map(e => e.department).filter(Boolean));
      const select = document.getElementById('logDeptFilter');
      select.innerHTML = `<option value="">All Departments</option>`;
      deptSet.forEach(dept => {
        select.innerHTML += `<option value="${dept}">${dept}</option>`;
      });
    }

    document.getElementById('logSearchInput').addEventListener('input', function() {
      filterAndRenderLogEntries();
    });
    document.getElementById('logDeptFilter').addEventListener('change', function() {
      filterAndRenderLogEntries();
    });
    document.getElementById('logStatusFilter').addEventListener('change', function() {
      filterAndRenderLogEntries();
    });

    function filterAndRenderLogEntries() {
      const search = document.getElementById('logSearchInput').value.toLowerCase();
      const dept = document.getElementById('logDeptFilter').value;
      const status = document.getElementById('logStatusFilter').value;
      let filtered = entries;
      if (dept) filtered = filtered.filter(e => e.department === dept);
      if (status) filtered = filtered.filter(e => e.status === status);
      if (search) filtered = filtered.filter(e =>
        (e.userName||'').toLowerCase().includes(search) ||
        (e.department||'').toLowerCase().includes(search)
      );
      renderLogEntriesTable(filtered);
    }

    db.collection('entries').onSnapshot(snap => {
      entries = snap.docs.map(doc => ({id: doc.id, ...doc.data()}));
      updateLogDeptFilter(entries);
      filterAndRenderLogEntries();
      updateDashboardStats(entries, users); // keep dashboard stats in sync
    });
    // --- Real-time Department Management ---
    function renderDepartmentsTable(departments, users) {
      const tbody = document.getElementById('departmentsTable');
      tbody.innerHTML = '';
      departments.forEach(dept => {
        const userCount = users.filter(u => u.department === dept.name).length;
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${dept.name || ''}</td>
          <td>${userCount}</td>
          <td>
            <button class='bg-green-600 text-white px-2 py-1 rounded' title='Edit'>Edit</button>
            <button class='bg-red-600 text-white px-2 py-1 rounded ml-2' title='Delete'>Delete</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    // Add department logic
    document.getElementById('deptNameInput').addEventListener('keydown', function(e) {
      if (e.key === 'Enter') addDepartment();
    });
    window.addDepartment = function() {
      const name = document.getElementById('deptNameInput').value.trim();
      if (!name) return;
      db.collection('departments').add({ name });
      document.getElementById('deptNameInput').value = '';
    };

    let departments = [];
    db.collection('departments').onSnapshot(snap => {
      departments = snap.docs.map(doc => ({id: doc.id, ...doc.data()}));
      renderDepartmentsTable(departments, users);
    });
    // Keep department table in sync with users
    db.collection('users').onSnapshot(snap => {
      users = snap.docs.map(doc => ({id: doc.id, ...doc.data()}));
      renderDepartmentsTable(departments, users);
      updateDepartmentFilter(users);
      filterAndRenderUsers();
    });
    // --- Real-time Reports & Analytics ---
    // Placeholder: show entries per department as a bar chart
    let reportsChart;
    function updateReportsChart(entries, departments) {
      const ctx = document.getElementById('overviewChart');
      const deptNames = departments.map(d => d.name);
      const deptCounts = deptNames.map(name => entries.filter(e => e.department === name).length);
      const chartElem = document.getElementById('section-reports').querySelector('canvas');
      if (!chartElem) return;
      if (!reportsChart) {
        reportsChart = new Chart(chartElem.getContext('2d'), {
          type: 'bar',
          data: {
            labels: deptNames,
            datasets: [{
              label: 'Entries per Department',
              data: deptCounts,
              backgroundColor: '#10b981',
              borderColor: '#059669',
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            plugins: { legend: { display: false } }
          }
        });
      } else {
        reportsChart.data.labels = deptNames;
        reportsChart.data.datasets[0].data = deptCounts;
        reportsChart.update();
      }
    }
    // Listen for changes and update chart
    function updateReportsSection() {
      updateReportsChart(entries, departments);
    }
    // Update chart when entries or departments change
    db.collection('entries').onSnapshot(snap => {
      entries = snap.docs.map(doc => ({id: doc.id, ...doc.data()}));
      updateReportsSection();
    });
    db.collection('departments').onSnapshot(snap => {
      departments = snap.docs.map(doc => ({id: doc.id, ...doc.data()}));
      updateReportsSection();
    });
    // --- Real-time System Settings ---
    function renderSettings(settings) {
      const section = document.getElementById('section-settings');
      section.innerHTML = `<h1 class="text-2xl font-bold text-green-700 mb-2">System Settings</h1>
        <div class="bg-white rounded-2xl card p-6">
          ${settings.length ? settings.map(s => `<div class='mb-2'><b>${s.key}:</b> ${s.value}</div>`).join('') : '<span class="text-gray-400">[No settings configured yet]</span>'}
        </div>`;
    }
    db.collection('settings').onSnapshot(snap => {
      const settings = snap.docs.map(doc => ({id: doc.id, ...doc.data()}));
      renderSettings(settings);
    });
    // --- Real-time Notifications & Logs ---
    function renderNotifications(notifications) {
      const section = document.getElementById('section-notifications');
      section.innerHTML = `<h1 class="text-2xl font-bold text-green-700 mb-2">Notifications & Logs</h1>
        <div class="bg-white rounded-2xl card p-6">
          ${notifications.length ? notifications.map(n => `<div class='mb-2'><b>${n.type||'Log'}:</b> ${n.message} <span class='text-xs text-gray-400'>${n.date ? new Date(n.date).toLocaleString() : ''}</span></div>`).join('') : '<span class="text-gray-400">[No notifications/logs yet]</span>'}
        </div>`;
    }
    db.collection('notifications').orderBy('date','desc').limit(20).onSnapshot(snap => {
      const notifications = snap.docs.map(doc => ({id: doc.id, ...doc.data()}));
      renderNotifications(notifications);
    });
    // --- Real-time Admin Profile ---
    function renderAdminProfile(admin) {
      const section = document.getElementById('section-profile');
      section.innerHTML = `<h1 class="text-2xl font-bold text-green-700 mb-2">Admin Profile</h1>
        <div class="bg-white rounded-2xl card p-6">
          ${admin ? `
            <div class='mb-2'><b>Name:</b> ${admin.name || ''}</div>
            <div class='mb-2'><b>Email:</b> ${admin.email || ''}</div>
            <div class='mb-2'><b>Role:</b> ${admin.role || 'Admin'}</div>
            <div class='mb-2'><b>Department:</b> ${admin.department || ''}</div>
          ` : '<span class="text-gray-400">[Admin profile not found]</span>'}
        </div>`;
    }
    // Find admin profile by email
    function updateAdminProfile() {
      db.collection('users').where('email','==',allowedAdminEmail).onSnapshot(snap => {
        const admin = snap.docs.length ? {...snap.docs[0].data(), id: snap.docs[0].id} : null;
        renderAdminProfile(admin);
      });
    }
    updateAdminProfile();
  </script>
</body>
</html>
